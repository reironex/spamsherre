<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ShareBoost â€“ Facebook Share Tool</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    /* === Keep all your previous styles === */
    body {
      font-family: Arial, sans-serif;
      background: #0f0f17;
      color: #eee;
      text-align: center;
      margin: 0;
      padding: 0;
      transition: background 0.3s, color 0.3s;
    }
    body.light-mode { background: #f4f4f4; color: #222; }
    h1 { color: #ff4ecd; margin-top: 20px; }
    body.light-mode h1 { color: #e91e63; }
    .tagline { font-size: 18px; margin-bottom: 20px; min-height: 24px; color: #aaa; }
    body.light-mode .tagline { color: #555; }

    form, #auth-container {
      max-width: 400px;
      margin: 0 auto 20px auto;
      background: #1a1a27;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      transition: background 0.3s;
    }
    body.light-mode form, body.light-mode #auth-container { background: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

    .label-icon {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #2a2a3d;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 14px;
      color: #ff4ecd;
      font-weight: bold;
      margin-bottom: 5px;
      transition: background 0.3s, color 0.3s;
    }
    body.light-mode .label-icon { background: #eee; color: #e91e63; }
    .label-icon i { transition: 0.2s; }
    .label-icon:hover i { transform: scale(1.2); color: #fff; }

    .tooltip {
      display: inline-block;
      position: relative;
      cursor: help;
      color: #ff4ecd;
      margin-left: 5px;
      font-size: 14px;
    }
    .tooltip:hover::after {
      content: attr(data-text);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 4px 8px;
      border-radius: 6px;
      white-space: nowrap;
      font-size: 12px;
      z-index: 100;
    }
    body.light-mode .tooltip:hover::after { background: #555; color: #fff; }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 2px solid transparent;
      outline: none;
      margin-bottom: 5px;
      background: #2a2a3d;
      color: #eee;
      transition: background 0.3s, color 0.3s, border 0.3s;
    }
    body.light-mode input { background: #f1f1f1; color: #222; }

    input.invalid { border: 2px solid #ff4e4e; }
    input.valid { border: 2px solid #32ff7e; }

    #cookie-feedback {
      font-size: 13px;
      margin-bottom: 10px;
      min-height: 18px;
      text-align: left;
      padding-left: 5px;
    }
    #cookie-feedback.valid { color: #32ff7e; }
    #cookie-feedback.invalid { color: #ff4e4e; }

    button {
      width: 48%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: 0.2s;
    }
    #submit-button { background: #ff4ecd; color: white; }
    #submit-button:hover { background: #e03bb3; }
    #stop-button { background: #444; color: #eee; }
    #stop-button:hover { background: #666; }
    body.light-mode #submit-button { background: #e91e63; }
    body.light-mode #submit-button:hover { background: #d81b60; }
    body.light-mode #stop-button { background: #ccc; color: #222; }
    body.light-mode #stop-button:hover { background: #bbb; }

    .btn-container { display: flex; justify-content: space-between; gap: 10px; }
    #result { margin-top: 15px; padding: 10px; border-radius: 8px; display: none; }

    #process-container {
      margin: 20px auto;
      max-width: 450px;
      background: #1c1c2b;
      border-radius: 10px;
      padding: 15px;
      display: none;
      transition: background 0.3s;
    }
    body.light-mode #process-container { background: #f1f1f1; }
    #share-summary { margin-top: 10px; font-weight: bold; color: #ff4ecd; }
    body.light-mode #share-summary { color: #e91e63; }
    .current-online { margin: 5px 0; background: #2a2a3d; padding: 8px; border-radius: 8px; font-size: 14px; text-align: left; display: flex; flex-direction: column; gap: 4px; transition: background 0.3s, color 0.3s; }
    body.light-mode .current-online { background: #eee; color: #222; }
    .status-row { display: flex; align-items: center; gap: 6px; justify-content: space-between; }
    .status-icon { width: 16px; height: 16px; border-radius: 50%; display: inline-block; }
    .progress-container { width: 100%; background: #333; border-radius: 8px; overflow: hidden; height: 10px; margin-top: 4px; transition: background 0.3s; }
    body.light-mode .progress-container { background: #ddd; }
    .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #32ff7e, #ff4ecd); transition: width 0.5s ease-in-out; }

    #mode-toggle-container {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 999;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0;
      right: 0; bottom: 0;
      background-color: #ff4ecd;
      transition: .4s;
      border-radius: 26px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 20px; width: 20px;
      left: 3px; bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider { background-color: #e91e63; }
    input:checked + .slider:before { transform: translateX(24px); }

    #auth-container input { width: calc(100% - 20px); padding: 8px; margin-bottom: 8px; }
    #auth-container button { width: calc(50% - 5px); padding: 8px; margin-bottom: 8px; font-size: 14px; }
    #auth-container { display: flex; flex-direction: column; gap: 8px; align-items: center; }
    #auth-container .auth-btns { display: flex; gap: 10px; width: 100%; justify-content: center; }

    #user-count {
      max-width: 400px;
      margin: 10px auto;
      text-align: left;
      background: #1a1a27;
      padding: 10px;
      border-radius: 8px;
      color: #32ff7e;
      font-size: 14px;
      transition: background 0.3s, color 0.3s;
    }
    body.light-mode #user-count { background: #eee; color: #222; }
  </style>
</head>
<body>

<div id="mode-toggle-container">
  <label class="switch">
    <input type="checkbox" id="mode-toggle">
    <span class="slider"></span>
  </label>
</div>

<h1><i class="fa-solid fa-bolt"></i> ShareBoost</h1>
<div class="tagline" id="tagline"></div>

<div id="auth-container">
  <input type="text" id="auth-username" placeholder="Username" required>
  <input type="password" id="auth-password" placeholder="Password" required>
  <label style="font-size:14px; display:flex; align-items:center; gap:6px;"><input type="checkbox" id="remember-me"> Remember Me</label>
  <div class="auth-btns">
    <button onclick="login()">Login</button>
    <button onclick="signup()">Create Account</button>
  </div>
</div>

<form id="main-form" onsubmit="submitForm(event)" style="display:none;">
  <label class="label-icon"><i class="fa-solid fa-user-lock"></i> AppState <span class="tooltip" data-text="Paste your Facebook AppState or cookie string">?</span>:</label>
  <div style="display:flex; gap:5px; align-items:center; margin-bottom:5px;">
    <input type="text" id="cookies" placeholder="Enter AppState or Cookie String" required style="flex:1;">
    <button type="button" id="convert-button" style="flex:none; padding:10px; border-radius:8px; background:#444; color:#eee; border:none; cursor:pointer;">Convert</button>
  </div>
  <div id="cookie-feedback"></div>

  <label class="label-icon"><i class="fa-solid fa-link"></i> Link <span class="tooltip" data-text="Enter the Facebook post link you want to boost">?</span>:</label>
  <input type="text" id="urls" placeholder="Enter Link" required>

  <label class="label-icon"><i class="fa-solid fa-hashtag"></i> Limit <span class="tooltip" data-text="Number of shares per session">?</span>:</label>
  <input type="number" id="amounts" placeholder="Enter Limit" required>

  <label class="label-icon"><i class="fa-solid fa-clock"></i> Interval (ms) <span class="tooltip" data-text="Delay between shares in milliseconds">?</span>:</label>
  <input type="number" id="intervals" placeholder="Enter Interval" required>

  <div class="btn-container">
    <button type="submit" id="submit-button"><i class="fa-solid fa-play"></i> Start</button>
    <button type="button" id="stop-button"><i class="fa-solid fa-stop"></i> Stop</button>
  </div>
  <div id="result"></div>
</form>

<div id="process-container">
  <h3><i class="fa-solid fa-chart-line"></i> Processing</h3>
  <div id="processing"></div>
  <div id="share-summary"></div>
</div>

<div id="user-count"><strong>Users:</strong> <span id="users-num">0</span></div>

<div style="text-align:center; margin:20px 0;">
  <button onclick="window.open('https://www.facebook.com/neitooonexxs','_blank')" 
          style="background:#1877f2;color:#fff;padding:6px 12px;font-size:14px;border:none;border-radius:6px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;">
    <i class="fa-brands fa-facebook"></i> Follow Neito
  </button>
</div>

<script>
  // === Theme toggle ===
  const toggleBtn = document.getElementById('mode-toggle');
  if(localStorage.getItem('theme') === 'light') {
    document.body.classList.add('light-mode');
    toggleBtn.checked = true;
  }
  toggleBtn.addEventListener('change', () => {
    document.body.classList.toggle('light-mode');
    localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
  });

  // === Typing tagline ===
  const text = "Automated tool that boosts your Facebook shares using AppState.";
  let i = 0;
  function typeWriter() {
    if (i < text.length) {
      document.getElementById("tagline").innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, 50);
    }
  }
  typeWriter();

  const authContainer = document.getElementById('auth-container');
  const mainForm = document.getElementById('main-form');
  const usersNum = document.getElementById('users-num');

  function updateUserCount() {
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    usersNum.textContent = Object.keys(users).length;
  }

  window.addEventListener('load', () => {
    const loggedInUser = localStorage.getItem('currentUser');
    const rememberedUser = localStorage.getItem('rememberedUser');
    if(loggedInUser){
      authContainer.style.display = 'none';
      mainForm.style.display = 'block';
    }
    if(rememberedUser){
      document.getElementById('auth-username').value = rememberedUser;
      document.getElementById('remember-me').checked = true;
    }
  });

  function signup() {
    const username = document.getElementById('auth-username').value.trim();
    const password = document.getElementById('auth-password').value.trim();
    if(!username || !password){ alert('Enter username & password'); return; }
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    if(users[username]){ alert('Username exists'); return; }
    users[username] = password;
    localStorage.setItem('users', JSON.stringify(users));
    alert('Account created! Please login.');
    updateUserCount();
  }

  function login() {
    const username = document.getElementById('auth-username').value.trim();
    const password = document.getElementById('auth-password').value.trim();
    if(!username || !password){ alert('Enter username & password'); return; }
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    if(users[username] && users[username] === password){
      alert('Login successful!');
      localStorage.setItem('currentUser', username);
      if(document.getElementById('remember-me').checked){
        localStorage.setItem('rememberedUser', username);
      } else {
        localStorage.removeItem('rememberedUser');
      }
      authContainer.style.display = 'none';
      mainForm.style.display = 'block';
      updateUserCount();
    } else{
      alert('Invalid credentials');
    }
  }

  updateUserCount();

  let refreshInterval;
  let currentId = null;
  let liveTimers = [];

  async function submitForm(event){
    event.preventDefault();
    const result = document.getElementById("result");
    const button = document.getElementById("submit-button");
    try{
      result.style.display="block";
      button.disabled=true;
      result.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Processing...';
      const response = await fetch("/api/submit", {
        method:"POST",
        body:JSON.stringify({
          cookie: document.getElementById("cookies").value,
          url: document.getElementById("urls").value,
          amount: document.getElementById("amounts").value,
          interval: document.getElementById("intervals").value,
        }),
        headers: { "Content-Type": "application/json" },
      });
      const data = await response.json();
      if(data.status===200){ 
        currentId=data.id; 
        result.style.backgroundColor="#1e4620"; 
        result.style.color="#32ff7e"; 
        result.innerHTML='<i class="fa-solid fa-circle-check"></i> Submitted successfully!'; 
      }
      else{ 
        result.style.backgroundColor="#3D1619"; 
        result.style.color="#FE6265"; 
        result.innerHTML='<i class="fa-solid fa-circle-xmark"></i> Error: '+data.error; 
      }
      button.disabled=false;
    }catch(e){ console.error(e); }
  }

  function formatTimeAgo(startTime){
    const now = Date.now();
    const diff = now - startTime;
    const seconds = Math.floor(diff / 1000);
    if(seconds < 60) return `${seconds}s ago`;
    const minutes = Math.floor(seconds/60);
    if(minutes < 60) return `${minutes}m ago`;
    const hours = Math.floor(minutes/60);
    return `${hours}h ago`;
  }

  async function linkOfProcessing(){
    const container=document.getElementById("processing");
    const summary=document.getElementById("share-summary");
    const processContainer=document.getElementById("process-container");
    
    const refresh = async ()=>{
      try{
        const res = await fetch("/total");
        if(!res.ok) return;
        const data = await res.json();
        container.innerHTML="";
        liveTimers = [];
        let totalCount=0, totalTarget=0;
        if(data.length===0){ 
          processContainer.style.display="none"; 
          summary.innerHTML='<i class="fa-solid fa-chart-pie"></i> Total Shares: 0'; 
          return; 
        }
        processContainer.style.display="block";
        data.forEach((link,index)=>{
          let {count,id,target,status,startTime}=link;
          totalCount+=count; totalTarget+=parseInt(target);
          const processCard=document.createElement("div");
          processCard.classList.add("current-online");
          let color="#ffc107"; if(status==="success") color="#32ff7e"; if(status==="failed") color="#ff4e4e";
          const timeSpan = document.createElement('span');
          timeSpan.style.fontSize="12px"; timeSpan.style.color="#aaa";
          processCard.innerHTML=`<div class="status-row"><span class="status-icon" style="background:${color}"></span>${index+1}. ID: ${id} | ${count}/${target} </div><div class="progress-container"><div class="progress-bar" style="width:${(count/target)*100}%"></div></div>`;
          processCard.querySelector('.status-row').appendChild(timeSpan);
          container.appendChild(processCard);

          if(startTime){
            liveTimers.push({span: timeSpan, startTime});
            timeSpan.textContent = formatTimeAgo(startTime);
          } else timeSpan.textContent = 'Just now';
        });
        summary.innerHTML=`<i class="fa-solid fa-chart-pie"></i> Total Shares: ${totalCount}/${totalTarget}`;
      }catch(err){ console.error(err); }
    };
    refreshInterval=setInterval(refresh,1000); 
    refresh();
    setInterval(()=>{
      liveTimers.forEach(obj => obj.span.textContent = formatTimeAgo(obj.startTime));
    },1000);
  }
  linkOfProcessing();

  document.getElementById("stop-button").addEventListener("click", async ()=>{
    const result = document.getElementById("result");
    if(!currentId){ 
      result.style.display = "block";
      result.style.backgroundColor = "#3D1619";
      result.style.color = "#FE6265";
      result.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> No active session to stop';
      return; 
    }
    try{
      const res=await fetch("/api/stop",{ 
        method:"POST", 
        headers:{"Content-Type":"application/json"}, 
        body:JSON.stringify({id:currentId})
      });
      const data=await res.json();
      if(data.status===200){ 
        if(refreshInterval){ clearInterval(refreshInterval); refreshInterval=null; } 
        document.getElementById("processing").innerHTML='<i class="fa-solid fa-circle-stop"></i> Sharing Stopped.'; 
        document.getElementById("share-summary").innerHTML='<i class="fa-solid fa-chart-pie"></i> Total Shares: 0'; 
        result.style.display="block";
        result.style.backgroundColor="#1e4620";
        result.style.color="#32ff7e";
        result.innerHTML='<i class="fa-solid fa-circle-check"></i> Session stopped successfully';
        currentId=null; 
      }
      else{ 
        result.style.display="block";
        result.style.backgroundColor="#3D1619";
        result.style.color="#FE6265";
        result.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> Error: '+(data.error||"Unknown");
      }
    }catch(err){ 
      console.error("Stop request failed",err); 
      result.style.display="block";
      result.style.backgroundColor="#3D1619";
      result.style.color="#FE6265";
      result.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> Failed to stop session';
    }
  });

  // Cookie to AppState
  const cookieInput = document.getElementById('cookies');
  const convertBtn = document.getElementById('convert-button');
  const feedback = document.getElementById('cookie-feedback');

  function validateCookie(str){
    if(!str.includes('=')) return false;
    return str.split(';').every(c=>c.trim().includes('='));
  }

  cookieInput.addEventListener('input', ()=>{
    const val = cookieInput.value.trim();
    if(validateCookie(val)){
      cookieInput.classList.add('valid');
      cookieInput.classList.remove('invalid');
      feedback.textContent = 'Valid cookie';
      feedback.classList.add('valid');
      feedback.classList.remove('invalid');
    } else {
      cookieInput.classList.add('invalid');
      cookieInput.classList.remove('valid');
      feedback.textContent = 'Not valid cookie';
      feedback.classList.add('invalid');
      feedback.classList.remove('valid');
    }
  });

  convertBtn.addEventListener('click', ()=>{
    const cookieStr = cookieInput.value.trim();
    if(!cookieStr) return alert('Enter cookie string first!');
    if(!validateCookie(cookieStr)){
      alert('Not valid cookie');
      return;
    }
    try{
      const now = Date.now();
      const appState = cookieStr.split(';').map(c => {
        let [key, ...rest] = c.trim().split('=');
        return {
          key: key,
          value: rest.join('='),
          domain: ".facebook.com",
          path: "/",
          hostOnly: false,
          creation: now,
          lastAccessed: now
        };
      });
      cookieInput.value = JSON.stringify(appState, null, 2);
      cookieInput.classList.add('valid');
      cookieInput.classList.remove('invalid');
      feedback.textContent = 'Converted to AppState';
      feedback.classList.add('valid');
      feedback.classList.remove('invalid');
      alert('Cookie converted to AppState!');
    }catch(e){
      alert('Failed to convert cookie. Check format.');
      cookieInput.classList.add('invalid');
      cookieInput.classList.remove('valid');
      feedback.textContent = 'Conversion failed';
      feedback.classList.add('invalid');
      feedback.classList.remove('valid');
      console.error(e);
    }
  });
</script>
</body>
</html>
